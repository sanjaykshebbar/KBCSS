DataBase Name: kbcss_users

Table - 1 
users:

CREATE TABLE `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `firstName` varchar(255) NOT NULL,
  `lastName` varchar(255) NOT NULL,
  `username` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  `phone` varchar(20) NOT NULL,
  `password` varchar(255) NOT NULL,
  `userType` enum('Student','Admin','Faculty','yet-to-confirm') DEFAULT 'yet-to-confirm',
  `userState` enum('registered','Active','Inactive','disabled') DEFAULT 'registered',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `email` (`email`),
  UNIQUE KEY `phone` (`phone`)
) ENGINE=InnoDB AUTO_INCREMENT=22 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci



Table - 2
login_activity

CREATE TABLE `login_activity` (
  `Login_id` int NOT NULL AUTO_INCREMENT,
  `id` int NOT NULL,
  `email` varchar(255) NOT NULL,
  `userType` varchar(50) NOT NULL,
  `login_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `logout_time` datetime DEFAULT NULL,
  `session_duration` int DEFAULT NULL,
  `ip_address` varchar(50) DEFAULT NULL,
  `user_agent` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`Login_id`)
) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci


Table - 3
password_resets 
CREATE TABLE `password_resets` (
  `email` varchar(255) NOT NULL,
  `token` varchar(255) NOT NULL,
  `expires` datetime NOT NULL,
  PRIMARY KEY (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci




CREATE TABLE Student_Degree (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    degreeType VARCHAR(255) DEFAULT NULL,
    semester INT DEFAULT NULL,
    registerNumber VARCHAR(255) DEFAULT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

//Auto update TRIGGER
DELIMITER $$

CREATE TRIGGER insert_student_degree AFTER INSERT ON users
FOR EACH ROW
BEGIN
    -- Only insert into Student_Degree if the userType is 'Student'
    IF NEW.userType = 'Student' THEN
        INSERT INTO Student_Degree (user_id) VALUES (NEW.id);
    END IF;
END$$

DELIMITER ;


